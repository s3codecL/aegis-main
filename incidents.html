<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Incidencias - Aegis HUB</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">
    <link rel="stylesheet" href="src/css/main.css" />
    <link rel="stylesheet" href="src/css/incidents.css" />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="icon" href="plugins/favorites - Chrome/ico.png" type="image/png" />
</head>

<body data-bs-theme="dark">
    <header class="navbar sticky-top">
        <div class="container-fluid px-4">
            <!-- Logo y Branding -->
            <div class="navbar-brand d-flex align-items-center">
                <svg class="icon-brand me-2" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.5" role="img" aria-label="Aegis shield icon">
                    <title>Aegis shield</title>
                    <path d="M12 2l7 4v5c0 5-3.5 9.5-7 11-3.5-1.5-7-6-7-11V6l7-4z" fill="none" stroke="currentColor"
                        stroke-linejoin="round" stroke-linecap="round"></path>
                    <path d="M9.5 10.5c.8.6 1.5.9 2.5.9s1.7-.3 2.5-.9" fill="none" stroke="currentColor"
                        stroke-linecap="round"></path>
                </svg>
                <div class="d-flex flex-column d-none d-md-flex">
                    <h1 class="mb-0" data-i18n="AEGIS_DASHBOARD">Aegis HUB</h1>
                    <small class="text-muted" data-i18n="INCIDENT_MANAGEMENT_TITLE">Gestión de Incidencias</small>
                </div>
            </div>

            <!-- Controles Derecha -->
            <div class="navbar-controls d-flex flex-grow-1 justify-content-end align-items-center gap-2">
                <!-- Tema -->
                <button class="btn btn-icon btn-ghost" id="themeToggle" title="Cambiar tema">
                    <svg id="iconLight" class="icon icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="display: none;">
                        <circle cx="12" cy="12" r="4"></circle>
                        <path
                            d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41">
                        </path>
                    </svg>
                    <svg id="iconDark" class="icon icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
                    </svg>
                </button>

                <!-- Idioma -->
                <button class="btn btn-ghost" id="langToggle" title="Cambiar idioma">
                    <span id="langText" class="fw-bold" style="font-size: 0.85rem;">ES</span>
                </button>

                <!-- Separador visual -->
                <div class="vr mx-2 d-none d-lg-block"></div>

                <!-- User Menu -->
                <div class="dropdown">
                    <button class="btn btn-user-profile dropdown-toggle" type="button" id="userDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-avatar">
                            <span id="userInitial">A</span>
                        </div>
                        <span class="user-name d-none d-md-inline" id="currentUserName"
                            data-i18n="USER_DEFAULT_NAME">Administrador</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-chevron-down ms-1" width="14"
                            height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6"></path>
                        </svg>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 dropdown-menu-user"
                        aria-labelledby="userDropdown">
                        <li>
                            <div class="dropdown-header-user" id="currentUserEmail">admin@aegis.local</div>
                        </li>
                        <li>
                            <hr class="dropdown-divider-user">
                        </li>
                        <li>
                            <a class="dropdown-item dropdown-item-user" href="index.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                <span data-i18n="DASHBOARD">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item dropdown-item-user" href="admin.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M12 20h9"></path>
                                    <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                                </svg>
                                <span data-i18n="ADMIN_PANEL">Panel Admin</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider-user">
                        </li>
                        <li>
                            <a class="dropdown-item dropdown-item-user text-danger" href="#" id="logoutBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                    <polyline points="16 17 21 12 16 7"></polyline>
                                    <line x1="21" y1="12" x2="9" y2="12"></line>
                                </svg>
                                <span data-i18n="LOGOUT">Cerrar Sesión</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="page-wrapper">
        <div class="page-body">
            <div class="container-xxl">

                <!-- Header con botón de nueva incidencia -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-lg-end align-items-center">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#incidentModal"
                                id="newIncidentBtn">
                                <svg class="icon me-2" width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                <span data-i18n="NEW_INCIDENT">Nueva Incidencia</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tarjetas de Estadísticas -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-3">
                        <div class="card card-stats">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader" data-i18n="TOTAL_INCIDENTS">Total Incidencias</div>
                                </div>
                                <div class="h1 mb-0 mt-2 text-primary" id="totalIncidents">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-3">
                        <div class="card card-stats">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader" data-i18n="OPEN_INCIDENTS">Abiertas</div>
                                </div>
                                <div class="h1 mb-0 mt-2 text-primary" id="openIncidents">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-3">
                        <div class="card card-stats">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader" data-i18n="INVESTIGATING">En Investigación</div>
                                </div>
                                <div class="h1 mb-0 mt-2 text-warning" id="investigatingIncidents">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12 mb-3">
                        <div class="card card-stats">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader" data-i18n="CRITICAL_INCIDENTS">Críticas</div>
                                </div>
                                <div class="h1 mb-0 mt-2 text-danger" id="criticalIncidents">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row g-3 filter-section">
                                    <div class="col-xl-3 col-lg-4 col-md-6">
                                        <label class="form-label" data-i18n="FILTER_BY_STATUS">Filtrar por
                                            Estado</label>
                                        <select class="form-select" id="filterStatus">
                                            <option value="">-- Todos --</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-3 col-lg-4 col-md-6">
                                        <label class="form-label" data-i18n="FILTER_BY_CRITICALITY">Filtrar por
                                            Criticidad</label>
                                        <select class="form-select" id="filterCriticality">
                                            <option value="">-- Todos --</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-3 col-lg-4 col-md-6">
                                        <label class="form-label" data-i18n="FILTER_BY_TYPE">Filtrar por Tipo</label>
                                        <select class="form-select" id="filterType">
                                            <option value="">-- Todos --</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-3 col-lg-12 col-md-6">
                                        <label class="form-label" data-i18n="SEARCH_INCIDENTS">Buscar</label>
                                        <input type="text" class="form-control" id="searchIncidents"
                                            data-i18n-placeholder="SEARCH_INCIDENTS_PLACEHOLDER"
                                            placeholder="Código, descripción, IP...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de Incidencias -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="INCIDENTS_LIST">Lista de Incidencias</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th data-i18n="CODE">Código</th>
                                                <th data-i18n="STATUS">Estado</th>
                                                <th style="width:32px"></th>
                                                <th data-i18n="CRITICALITY">Criticidad</th>
                                                <th data-i18n="TYPE">Tipo</th>
                                                <th data-i18n="DESCRIPTION">Descripción</th>
                                                <th data-i18n="AFFECTED_IP">IP Afectada</th>
                                                <th data-i18n="REPORTER">Reportado por</th>
                                                <th data-i18n="ACTIONS">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="incidentsTableBody">
                                            <tr>
                                                <td colspan="8" class="text-center text-muted py-4">
                                                    <span data-i18n="NO_INCIDENTS">No hay incidencias registradas</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal: Crear/Editar Incidencia -->
    <div class="modal fade" id="incidentModal" tabindex="-1" aria-labelledby="incidentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="incidentModalLabel" data-i18n="NEW_INCIDENT">Nueva Incidencia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="incidentForm">
                        <input type="hidden" id="incidentId" />

                        <!-- Accordion para secciones del formulario -->
                        <div class="accordion" id="incidentFormAccordion">

                            <!-- Sección 1: Información Básica -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingBasic">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseBasic" aria-expanded="true"
                                        aria-controls="collapseBasic">
                                        <strong data-i18n="BASIC_INFO">Información Básica</strong>
                                    </button>
                                </h2>
                                <div id="collapseBasic" class="accordion-collapse collapse show"
                                    aria-labelledby="headingBasic" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="DESCRIPTION">Descripción</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <textarea class="form-control" id="incidentDescription" rows="3"
                                                    required data-i18n-placeholder="DESCRIPTION_PLACEHOLDER"
                                                    placeholder="Descripción breve del incidente"></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="REPORTER">Reportado por</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <input type="text" class="form-control" id="incidentReporter" required
                                                    data-i18n-placeholder="REPORTER_PLACEHOLDER"
                                                    placeholder="Nombre del usuario que reporta">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="AFFECTED_IP">IP Afectada</span>
                                                </label>
                                                <input type="text" class="form-control" id="incidentAffectedIP"
                                                    data-i18n-placeholder="AFFECTED_IP_PLACEHOLDER"
                                                    placeholder="192.168.1.100">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="AFFECTED_HOSTNAME">Hostname Afectado</span>
                                                </label>
                                                <input type="text" class="form-control" id="incidentAffectedHost"
                                                    data-i18n-placeholder="AFFECTED_HOSTNAME_PLACEHOLDER"
                                                    placeholder="PC-USER-01">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 2: Detección -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingDetection">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseDetection" aria-expanded="false"
                                        aria-controls="collapseDetection">
                                        <strong data-i18n="DETECTION_INFO">Información de Detección</strong>
                                    </button>
                                </h2>
                                <div id="collapseDetection" class="accordion-collapse collapse"
                                    aria-labelledby="headingDetection" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="DETECTION_CHANNEL">Canal de Detección</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentDetectionChannel" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="CONFIDENCE_LEVEL">Nivel de Confianza</span>
                                                </label>
                                                <select class="form-select" id="incidentConfidence">
                                                    <option value="HIGH" data-i18n="CONFIDENCE_HIGH">Alto</option>
                                                    <option value="MEDIUM" selected data-i18n="CONFIDENCE_MEDIUM">Medio
                                                    </option>
                                                    <option value="LOW" data-i18n="CONFIDENCE_LOW">Bajo</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 3: Clasificación Técnica -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingClassification">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseClassification" aria-expanded="false"
                                        aria-controls="collapseClassification">
                                        <strong data-i18n="TECHNICAL_CLASSIFICATION">Clasificación Técnica</strong>
                                    </button>
                                </h2>
                                <div id="collapseClassification" class="accordion-collapse collapse"
                                    aria-labelledby="headingClassification" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="TYPE">Tipo de Incidente</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentType" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="AREA">Área Organizacional</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentArea" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="NIST_PHASE">Fase NIST 800-61</span>
                                                </label>
                                                <select class="form-select" id="incidentNistPhase">
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="MITRE_TACTIC">Táctica MITRE ATT&CK</span>
                                                </label>
                                                <select class="form-select" id="incidentMitreTactic">
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 4: Clasificación SGSI -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingSGSI">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseSGSI" aria-expanded="false"
                                        aria-controls="collapseSGSI">
                                        <strong data-i18n="SGSI_CLASSIFICATION">Clasificación SGSI (ISO 27035)</strong>
                                    </button>
                                </h2>
                                <div id="collapseSGSI" class="accordion-collapse collapse" aria-labelledby="headingSGSI"
                                    data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="IMPACT">Impacto</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentImpact" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                    <option value="Localized" data-i18n="IMPACT_LOCALIZED">Menor /
                                                        Localizado</option>
                                                    <option value="Limited" data-i18n="IMPACT_LIMITED">Moderado /
                                                        Limitado</option>
                                                    <option value="Wide" data-i18n="IMPACT_WIDE">Significativo / Amplio
                                                    </option>
                                                    <option value="Extensive" data-i18n="IMPACT_EXTENSIVE">Extenso /
                                                        Generalizado</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="URGENCY">Urgencia</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentUrgency" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                    <option value="Low" data-i18n="URGENCY_LOW_F">Baja</option>
                                                    <option value="Medium" data-i18n="URGENCY_MEDIUM_F">Media</option>
                                                    <option value="High" data-i18n="URGENCY_HIGH_F">Alta</option>
                                                    <option value="Critical" data-i18n="URGENCY_CRITICAL_F">Crítica
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="SGSI_CATEGORY">Categoría SGSI</span>
                                                </label>
                                                <select class="form-select" id="incidentSgsiCategory">
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="alert alert-info mb-0">
                                                    <strong data-i18n="PRIORITY">Prioridad</strong>:
                                                    <span id="calculatedPriority" class="badge bg-secondary"
                                                        data-i18n="NOT_CALCULATED">Sin calcular</span>
                                                    <br><small class="text-muted" data-i18n="PRIORITY_AUTO">Se calcula
                                                        automáticamente según Impacto x Urgencia</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 5: Asignación y Seguimiento -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingAssignment">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseAssignment" aria-expanded="false"
                                        aria-controls="collapseAssignment">
                                        <strong data-i18n="ASSIGNMENT_TRACKING">Asignación y Seguimiento</strong>
                                    </button>
                                </h2>
                                <div id="collapseAssignment" class="accordion-collapse collapse"
                                    aria-labelledby="headingAssignment" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="STATUS">Estado</span> <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <select class="form-select" id="incidentStatus" required>
                                                    <option value="" data-i18n="SELECT_PLACEHOLDER">-- Seleccionar --
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="ASSIGN_TO">Asignado a</span>
                                                </label>
                                                <input type="text" class="form-control" id="incidentAssignedTo"
                                                    data-i18n-placeholder="ASSIGNED_TO_PLACEHOLDER"
                                                    placeholder="Analista SOC, Administrador, etc.">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="SLA">SLA (horas)</span>
                                                </label>
                                                <input type="number" class="form-control" id="incidentSLA" min="1"
                                                    placeholder="24">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <span data-i18n="ESTIMATED_RESOLUTION">Resolución Estimada</span>
                                                </label>
                                                <input type="datetime-local" class="form-control"
                                                    id="incidentEstimatedResolution">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 6: Evidencias e IoCs -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingEvidence">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseEvidence" aria-expanded="false"
                                        aria-controls="collapseEvidence">
                                        <strong data-i18n="EVIDENCE_IOCS">Evidencias e Indicadores de Compromiso
                                            (IoCs)</strong>
                                    </button>
                                </h2>
                                <div id="collapseEvidence" class="accordion-collapse collapse"
                                    aria-labelledby="headingEvidence" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="MALICIOUS_IPS">IPs Maliciosas</span>
                                                </label>
                                                <textarea class="form-control" id="incidentMaliciousIPs" rows="2"
                                                    data-i18n-placeholder="MALICIOUS_IPS_PLACEHOLDER"
                                                    placeholder="192.168.1.50, 10.0.0.100 (separadas por comas)"></textarea>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="FILE_HASHES">Hashes de Archivos</span>
                                                </label>
                                                <textarea class="form-control" id="incidentFileHashes" rows="2"
                                                    data-i18n-placeholder="FILE_HASHES_PLACEHOLDER"
                                                    placeholder="SHA256: abc123... (separados por comas o saltos de línea)"></textarea>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="SUSPICIOUS_DOMAINS">Dominios Sospechosos</span>
                                                </label>
                                                <textarea class="form-control" id="incidentSuspiciousDomains" rows="2"
                                                    data-i18n-placeholder="SUSPICIOUS_DOMAINS_PLACEHOLDER"
                                                    placeholder="malicious-site.com, phishing-page.net (separados por comas)"></textarea>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="ARTIFACTS">Artefactos Adicionales</span>
                                                </label>
                                                <textarea class="form-control" id="incidentArtifacts" rows="3"
                                                    data-i18n-placeholder="ARTIFACTS_PLACEHOLDER"
                                                    placeholder="URLs, nombres de procesos, rutas de archivos, etc."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sección 7: Línea de Tiempo de Acciones -->
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="headingActions">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapseActions" aria-expanded="false"
                                        aria-controls="collapseActions">
                                        <strong data-i18n="ACTIONS_TIMELINE">Línea de Tiempo de Acciones</strong>
                                    </button>
                                </h2>
                                <div id="collapseActions" class="accordion-collapse collapse"
                                    aria-labelledby="headingActions" data-bs-parent="#incidentFormAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="CONTAINMENT">Contención</span>
                                                </label>
                                                <textarea class="form-control" id="incidentContainment" rows="3"
                                                    data-i18n-placeholder="CONTAINMENT_PLACEHOLDER"
                                                    placeholder="Acciones tomadas para contener el incidente"></textarea>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="ANALYSIS">Análisis</span>
                                                </label>
                                                <textarea class="form-control" id="incidentAnalysis" rows="3"
                                                    data-i18n-placeholder="ANALYSIS_PLACEHOLDER"
                                                    placeholder="Análisis técnico realizado"></textarea>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <span data-i18n="REMEDIATION">Remediación</span>
                                                </label>
                                                <textarea class="form-control" id="incidentRemediation" rows="3"
                                                    data-i18n-placeholder="REMEDIATION_PLACEHOLDER"
                                                    placeholder="Acciones de remediación aplicadas"></textarea>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">
                                                    <span data-i18n="LESSONS_LEARNED">Lecciones Aprendidas</span>
                                                </label>
                                                <textarea class="form-control" id="incidentLessons" rows="3"
                                                    data-i18n-placeholder="LESSONS_PLACEHOLDER"
                                                    placeholder="Lecciones aprendidas y mejoras a implementar"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        data-i18n="CANCEL">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="saveIncidentBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="18" height="18"
                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                            <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"></path>
                            <circle cx="12" cy="14" r="2"></circle>
                            <polyline points="14 4 14 8 8 8 8 4"></polyline>
                        </svg>
                        <span data-i18n="SAVE_INCIDENT">Guardar Incidencia</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import Auth from '/src/js/auth.js';
        import { Translations } from '/src/js/translations.js';
        import IncidentManager from '/src/js/incidents.js';

        // Protección de acceso - solo administradores
        document.addEventListener('DOMContentLoaded', function () {
            if (!Auth.requireAdmin()) {
                return;
            }

            // Mostrar nombre de usuario en navbar
            const currentUser = Auth.getCurrentUser();
            if (currentUser) {
                const userNameEl = document.getElementById('currentUserName');
                if (userNameEl) userNameEl.textContent = currentUser.name || currentUser.username || 'Admin';
            }

            // Inicializar tema
            const savedTheme = localStorage.getItem("theme") || "dark";
            document.body.setAttribute("data-bs-theme", savedTheme);
            updateThemeIcon(savedTheme);

            // Inicializar idioma
            const savedLang = localStorage.getItem("osintLanguage") || "es";
            Translations.setLanguage(savedLang);
            updateLangButton(savedLang);

            // Asegurar que las traducciones se aplican después de un breve delay
            setTimeout(() => {
                Translations.applyTranslations();
            }, 100);

            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    Swal.fire({
                        title: Translations.currentLanguage === 'en' ? 'Are you sure?' : '¿Estás seguro?',
                        text: Translations.currentLanguage === 'en' ? 'Do you want to logout?' : '¿Deseas cerrar sesión?',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: Translations.currentLanguage === 'en' ? 'Yes, logout' : 'Sí, cerrar sesión',
                        cancelButtonText: Translations.currentLanguage === 'en' ? 'Cancel' : 'Cancelar',
                        background: document.body.getAttribute('data-bs-theme') === 'dark' ? '#1a1f3c' : '#fff',
                        color: document.body.getAttribute('data-bs-theme') === 'dark' ? '#fff' : '#000'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Auth.logout();
                        }
                    });
                });
            }

            // Theme Toggle
            const themeToggle = document.getElementById("themeToggle");
            if (themeToggle) {
                themeToggle.addEventListener("click", () => {
                    const currentTheme = document.body.getAttribute("data-bs-theme");
                    const newTheme = currentTheme === "dark" ? "light" : "dark";
                    document.body.setAttribute("data-bs-theme", newTheme);
                    localStorage.setItem("theme", newTheme);
                    updateThemeIcon(newTheme);
                });
            }

            // Lang Toggle
            const langToggle = document.getElementById("langToggle");
            if (langToggle) {
                langToggle.addEventListener("click", () => {
                    const currentLang = Translations.currentLanguage;
                    const newLang = currentLang === "es" ? "en" : "es";
                    Translations.setLanguage(newLang);
                    updateLangButton(newLang);

                    // Re-renderizar incidencias
                    if (window.IncidentManager) {
                        IncidentManager.populateFilters();
                        IncidentManager.renderIncidents();
                        IncidentManager.updateStats();
                    }
                });
            }

            // Poblar selects cuando se abre el modal
            const incidentModal = document.getElementById('incidentModal');
            if (incidentModal) {
                incidentModal.addEventListener('shown.bs.modal', function () {
                    IncidentManager.populateFormSelects();
                });
            }
        });

        function updateThemeIcon(theme) {
            const iconLight = document.getElementById("iconLight");
            const iconDark = document.getElementById("iconDark");
            if (!iconLight || !iconDark) return;

            if (theme === "dark") {
                iconLight.style.display = "block";
                iconDark.style.display = "none";
            } else {
                iconLight.style.display = "none";
                iconDark.style.display = "block";
            }
        }

        function updateLangButton(lang) {
            const langText = document.getElementById("langText");
            if (langText) {
                langText.textContent = lang === "es" ? "EN" : "ES";
            }
        }

        // Hacer disponibles funciones globales si son llamadas por onclick inline
        window.editIncident = (id) => IncidentManager.editIncident(id);
        window.deleteIncident = (id) => IncidentManager.deleteIncident(id);
        window.viewIncident = (id) => IncidentManager.viewIncident(id);
    </script>
    <!-- Footer -->
    <footer class="footer mt-auto py-4">
        <div class="container-fluid px-3">
            <div class="row align-items-center">
                <div class="col-12 text-center d-flex flex-column align-items-center gap-3">
                    <div class="footer-branding d-flex flex-column align-items-center">
                        <small class="text-muted fw-bold" data-i18n="FOOTER_TEXT"></small>
                        <small class="text-muted opacity-75" data-i18n="FOOTER_MADE_WITH"></small>
                    </div>
                    <div class="social-links">
                        <a href="https://github.com/s3codecL" target="_blank" rel="noopener noreferrer" title="GitHub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                            </svg>
                        </a>
                        <a href="https://discord.gg/NVYadvZDtQ" target="_blank" rel="noopener noreferrer"
                            title="Discord">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276c-.598.3428-1.2205.6447-1.8733.8923a.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1835 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z" />
                            </svg>
                        </a>
                        <a href="https://www.youtube.com/@s3codecL" target="_blank" rel="noopener noreferrer"
                            title="YouTube">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                            </svg>
                        </a>
                        <a href="https://www.linkedin.com/in/gandradev/" target="_blank" rel="noopener noreferrer"
                            title="LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z" />
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to top button -->
    <button id="backToTop" class="back-to-top" aria-label="Volver arriba">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 15l-6-6-6 6" />
        </svg>
    </button>

    <script>
        // Back to top button visibility
        const backToTopBtn = document.getElementById('backToTop');
        if (backToTopBtn) {
            window.onscroll = function () {
                if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            };
            backToTopBtn.onclick = function () {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
        }
    </script>
</body>

</html>